<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>社团管理</title>

    <link rel="shortcut icon" href="favicon.ico">
    <link href="/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">
    <!-- Sweet Alert -->
    <link href="/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">
</head>

<body class="gray-bg top-navigation">
    <div onclick="aa()"></div>
    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom white-bg">
                <nav class="navbar navbar-static-top" role="navigation">
                    <div class="navbar-header">
                        <button aria-controls="navbar" aria-expanded="false" data-target="#navbar"
                            data-toggle="collapse" class="navbar-toggle collapsed" type="button">
                            <i class="fa fa-reorder"></i>
                        </button>
                        <a href="/html/news" class="navbar-brand">首页</a>
                    </div>
                    <div class="navbar-collapse collapse" id="navbar">
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a aria-expanded="false" role="button" href="#" class="dropdown-toggle"
                                    data-toggle="dropdown"> 菜单 <span class="caret"></span></a>
                                <ul role="menu" class="dropdown-menu">
                                    <li><a href="">菜单列表</a>
                                    </li>
                                    <li><a href="">菜单列表</a>
                                    </li>
                                    <li><a href="">菜单列表</a>
                                    </li>
                                    <li><a href="">M菜单列表</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="nav navbar-top-links navbar-right">
                            <li>
                                <a href="/html/login">
                                    <i class="fa fa-sign-out"></i> 退出
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
            <div class="wrapper wrapper-content">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>社团名字</h5>
                                    <div class="ibox-tools">
                                        <span class="label label-primary" id="clubType">社团类型：</span>
                                    </div>
                                </div>
                                <div class="ibox-content no-padding">
                                    <div class="flot-chart m-t-lg" style="height: 55px;">
                                        <h1 id="clubName" style="margin-left: 20%;"> </h1>
                                        <!-- <div><img src="xxxxxxxxx.jpg"></div> -->
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <span class="label label-success pull-right">个</span>
                                    <h5>社团人数</h5>
                                </div>
                                <div class="ibox-content">
                                    <h1 class="no-margins" style="margin-left: 40%;" id="clunNum"> </h1>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <span class="label label-info pull-right">注</span>
                                    <h5>男女比例</h5>
                                </div>
                                <div class="ibox-content">
                                    <h1 class="no-margins"  style="margin-left: 40%;" id="clubGender"></h1>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <span class="label label-primary pull-right">今天</span>
                                    <h5>访问人次</h5>
                                </div>
                                <div class="ibox-content">

                                    <div class="row">
                                        <div class="col-md-12">
                                            <h1 class="no-margins">redis中获取</h1>
                                            <div class="font-bold text-navy">超过22%的社团 <i class="fa fa-level-up"></i>
                                                <small>再接再厉</small>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>人员管理</h5>
                                    <div class="ibox-tools">
                                        <a class="collapse-link">
                                            <i class="fa fa-chevron-up" id="666"></i>
                                        </a>
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            <i class="fa fa-wrench"></i>
                                        </a>
                                        <ul class="dropdown-menu dropdown-user">
                                            <li><a href="#">查看移除人员</a>
                                            </li>
                                            <li><a href="#">查看权限</a>
                                            </li>
                                        </ul>
                                        <a class="close-link">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>姓名</th>
                                                    <th>班级</th>
                                                    <th>年级</th>
                                                    <th>职位</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table_tbody">
<!--                                                <tr>-->
<!--                                                    <td>name1</td>-->
<!--                                                    &lt;!&ndash; <td><span class="pie">0.52/1.561</span></td> &ndash;&gt;-->
<!--                                                    <td>计实</td>-->
<!--                                                    &lt;!&ndash; <td>20%</td> &ndash;&gt;-->
<!--                                                    <td>2017级</td>-->
<!--                                                    <td>团长</td>-->
<!--                                                    <td>-->
<!--                                                        <a data-toggle="modal" href="/html/manage#modal-form"><i-->
<!--                                                                class="fa fa-plus text-navy fa-2x"></i></a>-->
<!--                                                        &lt;!&ndash; <a data-toggle="modal" href="manage.html#updata-form"><i-->
<!--                                                                class="fa fa-check text-navy fa-2x"></i></a> &ndash;&gt;-->
<!--                                                        <a><i class="demo4 fa fa-trash text-navy fa-2x"></i></a>-->
<!--                                                        <a><i class="fa fa-user text-navy fa-2x"-->
<!--                                                                onclick="getid(123456)"></i></a>-->
<!--                                                    </td>-->
<!--                                                </tr>-->

                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-sm-11 m-b-xs">

                        </div>
                        <div class="col-sm-1">

                            <button type="button" class="btn btn-sm btn-primary" data-toggle="modal"
                                href="/html/manage#add-form">新增</button> </span>

                        </div>
                    </div>
                </div>

            </div>
            <div class="footer">
                <div class="pull-right">
                    By：<a href="http://www.zi-han.net" target="_blank"> XinjianCHEN </a>
                </div>
                <div>
                    <strong>Copyright</strong> &copy; 2021
                </div>
            </div>

        </div>
    </div>

    <div id="modal-form" class="modal fade" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12 b-r">
                            <div class="row">
                                <div class="col-sm-11 b-r">
                                    <h3 class="m-t-none m-b">编辑</h3>
                                    <p>通过填写对应信息新增社团成员(⊙o⊙)</p>
                                </div>
                                <div class="col-sm-1 b-r">
                                    <a href="/html/manage"> <i class="fa fa-times"></i></a>
                                </div>
                            </div>
                            <form role="form" action="localhosst:8080/xxxx/xxxx">
                                <div class="form-group">
                                    <label>学号：</label>
                                    <input type="number" placeholder="请输入新增学号" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>姓名：</label>
                                    <input type="text" placeholder="请输入姓名" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>职位：</label>
                                    <input type="text" placeholder="请输入职位" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>权限：</label>
                                    <input type="text" placeholder="请输入权限" class="form-control">
                                </div>
                                <!-- <div class="form-group">
                                    <label>密码：</label>
                                    <input type="password" placeholder="请输入密码" class="form-control">
                                </div> -->
                                <div>
                                    <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit"
                                        href="/html/manage#"><strong>确定编辑</strong>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="add-form" class="modal fade" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12 b-r">
                            <div class="row">
                                <div class="col-sm-11 b-r">
                                    <h3 class="m-t-none m-b">新增</h3>
                                    <p>通过填写对应信息新增社团成员(⊙o⊙)</p>
                                </div>
                                <div class="col-sm-1 b-r">
                                    <a href="/html/manage"> <i class="fa fa-times"></i></a>
                                </div>
                            </div>
                            <form role="form" id="addform" onsubmit="return false" action="#"
                                name="addform" method="POST" target="fmResult">
                                <div class="form-group">
                                    <label>学号：</label>
                                    <input type="number" th:name="studentID" id="studentID" name="studentID"
                                        placeholder="请输入新增学号" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>姓名：</label>
                                    <input type="text" th:name="studentName" id="studentName" name="studentName"
                                        placeholder="请输入姓名" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>职位：</label>
                                    <input type="text" th:name="work" id="work" name="work" placeholder="请输入职位"
                                        class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>权限：</label>
                                    <input type="text" th:name="authID" id="authID" name="authID" placeholder="请输入权限码"
                                           class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>社团代码</label>
                                    <input type="password" th:name="clubID" id="clubID" name="clubID" placeholder="社团代码"
                                        class="form-control" value="">
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit" id="submit"
                                    onclick="addperson()"><strong>确定新增</strong>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <iframe width="0px" height="0px" name="fmResult" style="display: none;"></iframe>
    </div>

    <!-- 全局js -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>

    <!-- 自定义js -->
    <script src="/js/content.js"></script>

    <!-- Sweet alert 弹窗样式 -->
    <script src="/js/plugins/sweetalert/sweetalert.min.js"></script>
    <!-- Flot -->
    <script src="/js/plugins/flot/jquery.flot.js"></script>
    <script src="/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="/js/plugins/flot/jquery.flot.resize.js"></script>

    <!-- ChartJS-->
    <script src="/js/plugins/chartJs/Chart.min.js"></script>

    <!-- Peity -->
    <script src="/js/plugins/peity/jquery.peity.min.js"></script>

    <!-- Peity demo -->
    <script src="/js/demo/peity-demo.js"></script>

    <!-- ECharts -->
    <script src="/js/plugins/echarts/echarts-all.js"></script>

    <!-- 自定义js -->
    <script src="/js/content.js?v=1.0.0"></script>
    <!-- <script src="../static/js/jquery.form.js"></script> -->
    <!-- ECharts demo data -->
    <script src="/js/demo/echarts-demo.js"></script>

    <script type="text/javascript">
        // 自启动方法
        // (function aa() {
        //     // console.log(123)
        //     $.ajax({
        //         type: "POST",
        //         url: "http://localhost:8888/club/getClubByID/1",
        //         // dataType: "text",
        //         dataType: "json",
        //         async: false,

        //         success: function (data) {
        //             $("#clubName").append(data.clubName);
        //             console.log(data)
        //         },
        //         error: function (data) {
        //             alert("请求出错" + data);
        //             console.log(data);
        //         }
        //     })
        // })()

        // function showData(data) {
        //     var str = ""; //定义用于拼接的字符串4         
        //     for (var i = 0; i < data.length; i++) {
        //         //拼接表格的行和列
        //         str = "<tr><td>" + data[i].name + "</td><td>" + data[i].password + "</td></tr>"; //改！
        //         //追加到table中
        //         $("#table_tbody").append(str);
        //     }
        // }

        // 执行删除任务
        function getid(id) {
            console.log(id);
            swal({
                    title: "您确定要从社团删除这个人的信息吗",
                    text: "人间有情，请谨慎操作！",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "是的，我要删除！",
                    cancelButtonText: "让我再考虑一下…",
                    closeOnConfirm: false,
                    closeOnCancel: false
                },
                function (isConfirm) {
                    if (isConfirm) {
                        //ajax
                        $.ajax({
                            type: "post",
                            url: "/club/deleteById",
                            data: {
                                "id": id
                            },
                            dataType: "json",
                            async: false,
                            success: function (data) {
                                console.log(data);
                                window.location.reload(true);
                            },
                            error: function (data) {
                                alert("AJAX请求出错" + data);
                            }
                        })
                        // alert("删除执行完毕-id：" + id);

                        swal("删除成功！", "您已经删除了这条信息。", "success");
                    } else {
                        swal("已取消", "您取消了删除操作！", "error");
                    }
                });
        }


        $(document).ready(function () {
            //全局变量
            let club;
            //社团名字
            console.log("显示社团信息")
            $.ajax({
                type: "POST",
                // url: "http://localhost:8888/club/getClubByID/2",

                url: "/club/getClubByShiro",
                // dataType: "text",
                dataType: "json",
                async: false,

                success: function (data) {
                    club = data.data
                    $("#clubName").append(data.data.clubName);
                    $("#clunNum").append(data.data.clubNum);
                    $("#clubType").append(data.data.clubInfo);
                    console.log(data)
                    return club;
                },
                error: function (data) {
                    alert("AJAX请求出错" + data);
                    console.log(data);
                }
            })

            // 试着添加  成功
            $("#clubID").append(club.clubID);

            console.log("列出表格")
            var Num_M=0;
            var Num_w=0;
            $.ajax({
                type: "post",
                // url:"http://localhost:8888/club/getStudentListByClubID/2",
                url: "/club/getStudentListByShiro",
                dataType: "json",
                async: false,

                success: function (data) {
                    console.log(data.data)
                    for (var list of data.data) {
                        console.log(list.studentName)
                        var str = "";
                        str = "<tr><td>" + list.studentName + "</td><td>" + list.studentMajor +
                            "</td><td>" + list.studentGrade + "</td><td>" + list.work + "</td>" +
                            ' <td id="' + list.studentID +
                            '"><a data-toggle="modal" href="/html/manage#modal-form"><i class="fa fa-plus text-navy fa-2x"></i></a><a><i class="demo4 fa fa-trash text-navy fa-2x "onclick="getid(' +
                            list.studentID + ')"></i></a></td></tr>';
                        //追加到table中
                        $("#table_tbody").append(str);
                        if(list.studentGrade="男"){Num_M++}else Num_w++
                    }
                    console.log("studentlist循环完毕")
                    $("#clubGender").append(Num_M+":"+Num_w);

                },
                error: function (data) {
                    alert("AJAX请求出错" + data);
                    console.log(data);

                }
            })
        })
    </script>

    <script type="text/javascript">
        function addperson(){
            $.ajax({
                type:"POST",
                dataType:"text",
                url:"/club/addClubMenber2",
                data: $('#addform').serialize(),
                success:function(data){
                    let code=JSON.parse(data).code;
                    if(code==200) {
                        alert("add成功");
                        console.log(data);
                        window.location.reload(true);
                    }else if(code==400){alert("add权限不足");}
                },
                error:function(){
                    alert("add执行出错")
                }
            })
        }
        
    </script>

    <script type="text/javascript">
        function turnoff(obj) {
            // 增删改查点击消失div
            document.getElementById(obj).style.display = "none";
        };

        function relode() {
            window.location.reload(true);
        }
    </script>

</body>

</html>